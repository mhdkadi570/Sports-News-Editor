<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📰 مولّد أخبار كرة القدم</title>
  <style>
    body { font-family: Tahoma, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    select, button, textarea { margin-top: 10px; display: block; }
    select, button { padding: 8px; }
    textarea { width: 100%; height: 220px; }
  </style>
</head>
<body>
  <h1>📰 محرر أخبار المباريات</h1>

  <label>اختر المباراة:</label>
  <select id="matches"></select>
  <button onclick="generateNews()">إنشاء الخبر</button>

  <h2>النص الناتج:</h2>
  <textarea id="newsOutput"></textarea>

  <script>
    const apiKey = "YOUR_API_KEY_HERE"; // ضع مفتاحك هنا

    // جلب مباريات اليوم والأمس
    async function loadMatches() {
      const today = new Date();
      const yesterday = new Date();
      yesterday.setDate(today.getDate() - 1);

      const formatDate = d => d.toISOString().split("T")[0];

      const urls = [
        `https://v3.football.api-sports.io/fixtures?date=${formatDate(today)}`,
        `https://v3.football.api-sports.io/fixtures?date=${formatDate(yesterday)}`
      ];

      let allMatches = [];

      for (let url of urls) {
        const res = await fetch(url, { headers: { "x-apisports-key": apiKey } });
        const data = await res.json();
        allMatches = allMatches.concat(data.response);
      }

      const select = document.getElementById("matches");
      allMatches.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m.fixture.id;
        opt.textContent = `${m.teams.home.name} vs ${m.teams.away.name} (${m.league.name})`;
        select.appendChild(opt);
      });
    }

    // توليد الخبر
    async function generateNews() {
      const matchId = document.getElementById("matches").value;

      try {
        const res = await fetch(`https://v3.football.api-sports.io/fixtures?id=${matchId}`, {
          headers: { "x-apisports-key": apiKey }
        });
        const data = await res.json();
        const match = data.response[0];

        const league = match.league.name;
        const round = match.league.round;
        const home = match.teams.home.name;
        const away = match.teams.away.name;
        const goalsHome = match.goals.home;
        const goalsAway = match.goals.away;

        // أحداث المباراة
        const eventsRes = await fetch(`https://v3.football.api-sports.io/fixtures/events?fixture=${matchId}`, {
          headers: { "x-apisports-key": apiKey }
        });
        const eventsData = await eventsRes.json();

        let goalsText = "";
        let redCards = "";

        eventsData.response.forEach(ev => {
          if (ev.type === "Goal") {
            goalsText += `${ev.player.name} سجل في الدقيقة ${ev.time.elapsed}. `;
          }
          if (ev.type === "Card" && ev.detail === "Red Card") {
            redCards += `بطاقة حمراء لـ ${ev.player.name} في الدقيقة ${ev.time.elapsed}. `;
          }
        });

        // الترتيب
        const standingsRes = await fetch(`https://v3.football.api-sports.io/standings?league=${match.league.id}&season=${match.league.season}`, {
          headers: { "x-apisports-key": apiKey }
        });
        const standingsData = await standingsRes.json();
        const table = standingsData.response[0].league.standings[0];
        const homeRank = table.find(t => t.team.id === match.teams.home.id)?.rank;
        const awayRank = table.find(t => t.team.id === match.teams.away.id)?.rank;

        // قوالب متعددة
        const templates = [
          `في ${round} من ${league}، انتهت مواجهة ${home} و${away} بنتيجة ${goalsHome}-${goalsAway}. ${goalsText}${redCards}بعد اللقاء، ${home} في المركز ${homeRank} و${away} في المركز ${awayRank}.`,
          `على أرض ${home}، استضاف الفريق ${away} ضمن ${round} من ${league}. المباراة انتهت ${goalsHome}-${goalsAway}. ${goalsText}${redCards}بهذا، ${home} يحتل المركز ${homeRank} بينما ${away} في المركز ${awayRank}.`,
          `شهدت الجولة ${round} من ${league} مباراة بين ${home} و${away} انتهت بنتيجة ${goalsHome}-${goalsAway}. ${goalsText}${redCards}الترتيب بعد المباراة: ${home} في المركز ${homeRank} و${away} في المركز ${awayRank}.`
        ];

        // اختيار قالب عشوائي
        const news = templates[Math.floor(Math.random() * templates.length)];

        document.getElementById("newsOutput").value = news;

      } catch (err) {
        document.getElementById("newsOutput").value = "حدث خطأ: " + err;
      }
    }

    loadMatches();
  </script>
</body>
</html>
